
@{
    ViewBag.Title = "Book Appointment";
}
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!--Date Dropper-->
<link href="~/Content/Plugins/Datedropper3/datedropper.css" rel="stylesheet" />
<script src="~/Content/Plugins/Datedropper3/datedropper.js"></script>
<link href="~/Content/StyleSheets/DateDropperCivica.css" rel="stylesheet" />
<!--JQuerryTimePicker-->
<script src="~/Content/Plugins/jquery-timepicker-1.3.5/jquery.timepicker.min.js"></script>
<link href="~/Content/Plugins/jquery-timepicker-1.3.5/jquery.timepicker.min.css" rel="stylesheet" />
<script>

    function CancelFetchAppointment() {
        $('#availableRooms').css('display', 'none');
        $('#unAvailableRoomsDiv').css("display", "none");
    }

    function bookAppointment() {

        $("#messages").empty();

        var data = {
            FloorID: $('#FloorSelection').val(),
            Capacity: $('#NumberOfAttendees').val(),
            Subject: $('#AppointmentTitle').val()
        };
        var jqxhr = $.post("BookAppointments", data, function () { }, 'json')
    .done(function (response) {
        if (response instanceof Object)
            var json = response;
        else
            var json = $.parseJSON(response);

        if (json.Errors.length > 0) {
            $('#messages').css('display', 'block');
            $('#unAvailableRoomsDiv').css("display", "none");

            for (var i = 0; i < json.Errors.length; i++) {
                $('#messages').append(json.Errors[i]+'<br />' + "\n");
            }
        }
        else if (json.Output.Message!=null && json.Output.Message != '') {
            $('#messages').css('display', 'block');
            $('#unAvailableRoomsDiv').css("display", "none");
            $('#messages').append(json.Output.Message);
        }
        else if (json.Errors.length == 0 && (json.Output.Message==null || json.Output.Message==''))
        {
            $('#messages').css('display', 'block');
            $('#unAvailableRoomsDiv').css("display", "none");
            $('#messages').append("Room booked successfully.");
        }
    });
    };


    function checkAvailability() {

        $("#Cal").empty();
        $("#CalForNotMatched").empty();
        $('#messages').css('display', 'none');

        var tr;
        tr = $('<tr class=\'trRoomHeader\'/>');
        tr.append("<th style=\'width:40%\' class=\'tdRoom\'>Room Name</th>");
        tr.append("<th style=\'width:15%\' class=\'tdRoom\'>Start Date</th>");
        tr.append("<th style=\'width:15%\' class=\'tdRoom\'>Start Time</th>");
        tr.append("<th style=\'width:15%\' class=\'tdRoom\'>End Date</th>");
        tr.append("<th style=\'width:15%\' class=\'tdRoom\'>End Time</th>");
        $('#Cal').append(tr);

        var trForNotMatched;
        trForNotMatched = $('<tr class=\'trRoomHeader\'/>');
        trForNotMatched.append("<th style=\'width:30%\' class=\'tdRoom\'>Start Date</th>");
        trForNotMatched.append("<th style=\'width:30%\' class=\'tdRoom\'>Start Time</th>");
        trForNotMatched.append("<th style=\'width:20%\' class=\'tdRoom\'>End Time</th>");
        trForNotMatched.append("<th style=\'width:20%\' class=\'tdRoom\'>Action</th>");
        $('#CalForNotMatched').append(trForNotMatched);


        //For Daily
        var isEveryDay = false;
        var isEveryDayWorking = false;
        var everySpecifiedWorkingDate = -1;

        //For Weekly
        var isSunday = false;
        var isMonday = false;
        var isTuesday = false;
        var isWednesday = false;
        var isThursday = false;
        var isFriday = false;
        var isSaturday = false;

        //For Monthly
        var dayVise = false;
        var dayTypeVise = false;

        var Nthday = -1;
        var DayMonth = -1;

        var NthMonthDay = "";
        var DayTypeMonth = "";
        var MonthNumber = -1;



        switch ($("#ActiveSelectionTab").val()) {

            //Daily
            case '1':
                switch ($('input[name=DailySelectionType]:checked').val()) {
                    case '1':
                        {
                            isEveryDay = true;
                        }
                        break;
                    case '2':
                        {
                            isEveryDayWorking = true;
                        }
                        break;
                    case '3':
                        {
                            everySpecifiedWorkingDate = $('#DailyRepeatFrequency').val();
                        }
                        break;

                }
                break;

                //Weekly
            case '2':
                $("input:checkbox[name=WeeklySelectionType]:checked").each(function () {
                    switch ($(this).val()) {
                        case '1':
                            {
                                isSunday = true;
                            }
                            break;
                        case '2':
                            {
                                isMonday = true;
                            }
                            break;
                        case '3':
                            {
                                isTuesday = true;
                            }
                            break;
                        case '4':
                            {
                                isWednesday = true;
                            }
                            break;
                        case '5':
                            {
                                isThursday = true;
                            }
                            break;
                        case '6':
                            {
                                isFriday = true;
                            }
                            break;
                        case '7':
                            {
                                isSaturday = true;

                            }
                            break;
                    }
                });
                break;

                //Monthly
            case '3': switch ($('input[name=MonthlySelectionType]:checked').val()) {
                case '1':
                    {
                        var dayVise = true;
                        Nthday = $('#DayWiseSelection-Days').val();
                        DayMonth = $('#DayWiseSelection-Month').val();
                    }
                    break;

                case '2':
                    {
                        dayTypeVise = true;
                        NthMonthDay = $('#MonthWiseSelection-daytype').val();
                        DayTypeMonth = $('#MonthWiseSelection-day').val();
                        MonthNumber = $('#MonthWiseSelection-Month').val();
                    }
                    break;

            }
                break;

                //Custom
            case '4':
                break;

        }

        var data = {
            Capacity: $('#NumberOfAttendees').val(),
            FloorID: $('#FloorSelection').val(),
            StartDate: $('#StartDate').val(),
            EndtDate: $('#EndDate').val(),
            StartTime: $('#StartTime').val(),
            Duration: $('#Duration').val(),

            RecurrenceType: $('#ActiveSelectionTab').val(),
            //ForDaily
            IsEveryDay: isEveryDay,
            IsEveryDayWorking: isEveryDayWorking,
            EverySpecifiedWorkingDate: everySpecifiedWorkingDate,
            //ForWeekly
            IsSunday: isSunday,
            IsMonday: isMonday,
            IsTuesday: isTuesday,
            IsWednesday: isWednesday,
            IsThursday: isThursday,
            IsFriday: isFriday,
            IsSaturday: isSaturday,
            //For Weekly
            DayVise: dayVise,
            Nthday: Nthday,
            DayMonth: DayMonth,
            DayTypeVise: dayTypeVise,
            NthMonthDay: NthMonthDay,
            DayTypeMonth: DayTypeMonth,
            MonthNumber: MonthNumber


        };
        var jqxhr = $.post("FetchAvailability", data, function () { }, 'json')
    .done(function (response) {
        if (response instanceof Object)
            var json = response;
        else
            var json = $.parseJSON(response);

        $("#Cal").empty();
        $("#CalForNotMatched").empty();


        var tr;
        tr = $('<tr class=\'trRoomHeader\'/>');
        tr.append("<th style=\'width:40%\' class=\'tdRoom\'>Room Name</th>");
        tr.append("<th style=\'width:15%\' class=\'tdRoom\'>Start Date</th>");
        tr.append("<th style=\'width:15%\' class=\'tdRoom\'>Start Time</th>");
        tr.append("<th style=\'width:15%\' class=\'tdRoom\'>End Date</th>");
        tr.append("<th style=\'width:15%\' class=\'tdRoom\'>End Time</th>");
        $('#Cal').append(tr);
        //Append each row to html table
        for (var i = 0; i < json.length; i++) {
            if (json[i].IsAvailable == true) {
                tr = $('<tr/>');
            }
            else {
                tr = $('<tr class=\'trRoom\'/>');
            }
            tr.append("<td style=\'width:40%\' class=\'tdRoom\'>" + json[i].RoomName + "</td>");
            tr.append("<td style=\'width:15%\' class=\'tdRoom\'>" + json[i].BookingSlot.StartDate + "</td>");
            tr.append("<td style=\'width:15%\' class=\'tdRoom\'>" + json[i].BookingSlot.StartTime + "</td>");
            tr.append("<td style=\'width:15%\' class=\'tdRoom\'>" + json[i].BookingSlot.EndDate + "</td>");
            tr.append("<td style=\'width:15%\' class=\'tdRoom\'>" + json[i].BookingSlot.EndTime + "</td>");
            $('#Cal').append(tr);
        }
        if (json.length > 0) {
            $('#availableRooms').css('display', 'block');
        }



        var trForNotMatched;
        trForNotMatched = $('<tr class=\'trRoomHeader\'/>');
        trForNotMatched.append("<th style=\'width:30%\' class=\'tdRoom\'>Start Date</th>");
        trForNotMatched.append("<th style=\'width:30%\' class=\'tdRoom\'>Start Time</th>");
        trForNotMatched.append("<th style=\'width:20%\' class=\'tdRoom\'>End Time</th>")
        trForNotMatched.append("<th style=\'width:20%\' class=\'tdRoom\'>Action</th>");

        $('#CalForNotMatched').append(trForNotMatched);
        var countForunAvailableRooms = 0;
        //Append each row to html table
        for (var i = 0; i < json.length; i++) {
            if (json[i].IsAvailable == false) {
                trForNotMatched = $('<tr/>');
                trForNotMatched.append("<td style=\'width:25%\' class=\'tdRoom\'>" + json[i].BookingSlot.StartDate + "</td>");
                trForNotMatched.append("<td style=\'width:25%\' class=\'tdRoom\'>" + json[i].BookingSlot.StartTime + "</td>");
                trForNotMatched.append("<td style=\'width:25%\' class=\'tdRoom\'>" + json[i].BookingSlot.EndTime + "</td>");
                trForNotMatched.append("<td style=\'width:25%\' class=\'tdRoom\'></td>");
                countForunAvailableRooms++;
            }
            $('#CalForNotMatched').append(trForNotMatched);
        }
        if (countForunAvailableRooms > 0) {
            $('#unAvailableRoomsDiv').css("display", "block");           
        }
    });
    };

</script>
@using (Html.BeginForm("MultipleCommand", "Home", FormMethod.Post, new { id = "submitForm" }))
{
    <div class="mainDivision">
        <div>
            <!--Left Divisions with input fields-->
            <div style="float:left;" class="innerDivisionleft">
                <table>
                    <!--Meeting Title Iuput-->
                    <tr>
                        <td>
                            Appointment Title :
                        </td>
                        <td colspan="5">
                            <input id="AppointmentTitle" name="AppointmentTitle" class="FullSpread" type="text" />
                        </td>
                    </tr>
                    <tr>
                        <!--Floor Selection Drop Dopwn-->
                        <td>
                            Select Floor :
                        </td>
                        <td>
                            @Html.DropDownList("FloorSelection", ViewData["Floors"] as List<SelectListItem>, new { @class = "FullSpread" })
                        </td>
                        <!--Number of Attendees -->
                        <td>
                            No. of Attendees :
                        </td>
                        <td>
                            <input class="GeneralNumberInput" id="NumberOfAttendees" name="NumberOfAttendees" type="number" min="2" value="2">
                        </td>
                    </tr>
                    <tr>
                        <!--Start Date input-->
                        <td>
                            Start Date :
                        </td>
                        <td>
                            <input id="StartDate" name="StartDate" class="DateInput" type="text" data-format="d/M/Y" data-large-mode="true" data-large-default="true" data-lock="from" data-theme="DateDropperCivica" data-min-year="2018" data-max-year="2028" />
                            <script>
                                $('#StartDate').dateDropper();
                            </script>
                        </td>
                        <!--End Date input-->
                        <td>
                            End Date :
                        </td>
                        <td>
                            <input id="EndDate" name="EndDate" class="DateInput" type="text" data-format="d/M/Y" data-large-mode="true" data-large-default="true" data-lock="from" data-theme="DateDropperCivica" data-min-year="2018" data-max-year="2028" />
                            <script>
                                $('#EndDate').dateDropper();
                            </script>
                        </td>
                    </tr>
                    <tr>
                        <!--Start Time Input-->
                        <td>
                            Start Time :
                        </td>
                        <td>
                            <input id="StartTime" name="StartTime" class="TimeInput" type="text" onchange="alert('changed')" />
                            <script>
                                $('.TimeInput').timepicker({
                                    timeFormat: 'hh:mm p',
                                    interval: 15,
                                    minTime: '10',
                                    maxTime: '10:00pm',
                                    defaultTime: 'now',
                                    startTime: '10:00',
                                    dynamic: false,
                                    dropdown: true,
                                    scrollbar: true
                                });
                            </script>
                        </td>
                        <!--Time Duration-->
                        <td>
                            Duration :
                        </td>
                        <td>
                            <input id="Duration" name="Duration" class="TimeInput2" type="text" />
                            <script>
                                $('.TimeInput2').timepicker(
                                    {
                                        timeFormat: 'HH:mm',
                                        interval: 15,
                                        minTime: '0',
                                        maxTime: '23:00pm',
                                        defaultTime: '0:15',
                                        dynamic: false,
                                        dropdown: true,
                                        scrollbar: true
                                    });
                            </script>
                        </td>
                    </tr>
                    <tr>
                        <!--End Time-->
                        <td>
                            End Time :
                        </td>
                        <td>
                            <input id="EndTime" name="EndTime" class="TimeInput" type="text" disabled />
                        </td>
                    </tr>
                    <tr>
                        <!--Regression Type Selection Tabs-->
                        <td id="RegressionTypeSelectionTableData" colspan="6">
                            <input type="hidden" id="ActiveSelectionTab" name="ActiveSelectionTab" value="1">
                            <script>
                                function SelectDaily() {
                                    document.getElementById("ActiveSelectionTab").value = 1;

                                }
                                function SelectWeekly() {
                                    document.getElementById("ActiveSelectionTab").value = 2;
                                }
                                function SelectMonthly() {
                                    document.getElementById("ActiveSelectionTab").value = 3;
                                }
                                function SelectCustom() {
                                    document.getElementById("ActiveSelectionTab").value = 4;
                                }
                            </script>
                            <!--Selection Tabs-->
                            <div class="tab">
                                <input type="button" class="tablinks" onclick="SelectDaily();openTab(event, 'Daily')" id="defaultOpen" value="Daily" /><br />
                                <input type="button" class="tablinks" onclick="SelectWeekly(); openTab(event, 'Weekly')" value="Weekly"><br />
                                <input type="button" class="tablinks" onclick="SelectMonthly();openTab(event, 'Monthly')" value="Monthly"><br />
                                <input type="button" class="tablinks" onclick="SelectCustom();openTab(event, 'Custom')" value="Custom"><br />
                            </div>
                            <!--Daily Selection-->
                            <div id="Daily" class="tabcontent">
                                <script>
                                    function EveryDayRadioCheck() {
                                        document.getElementById("DailyRepeatFrequency").disabled = "true";
                                    }
                                    function EveryNDayRadioCheck() {

                                        document.getElementById("DailyRepeatFrequency").disabled = ! "true";
                                    }
                                    function EveryWorkingDayRadioCheck() {
                                        document.getElementById("DailyRepeatFrequency").disabled = ! "true";
                                    }

                                </script>
                                <input id="EveryDay" name="DailySelectionType" type="radio" onclick="javascript:EveryDayRadioCheck()" checked="checked" value="1"> Every Day
                                <br /><br />
                                <input id="EveryWorkingDay" name="DailySelectionType" type="radio" onclick="javascript:EveryDayRadioCheck()" value="2"> Every Working Day
                                <br /><br />
                                <input id="EveryNDay" name="DailySelectionType" type="radio" onclick="javascript:EveryWorkingDayRadioCheck()" value="3">
                                Every <input class="GeneralNumberInput" id="DailyRepeatFrequency" type="number" min="2" value="2" disabled/> Day(s).

                            </div>
                            <!--Weekly Selection-->
                            <div id="Weekly" class="tabcontent">
                                <div style="float:left;">
                                    <input id="Monday" name="WeeklySelectionType" type="checkbox" value="2"> Monday<br />
                                    <input id="Tuesday" name="WeeklySelectionType" type="checkbox" value="3"> Tuesday<br />
                                    <input id="Wednesday" name="WeeklySelectionType" type="checkbox" value="4"> Wednesday<br />
                                    <input id="Thursday" name="WeeklySelectionType" type="checkbox" value="5"> Thursday<br />
                                    <input id="Friday" name="WeeklySelectionType" type="checkbox" value="6"> Friday<br />
                                </div>
                                <div style="float:right">
                                    <input id="Saturday" name="WeeklySelectionType" type="checkbox" value="7"> Saturday<br />
                                    <input id="Sunday" name="WeeklySelectionType" type="checkbox" value="1"> Sunday<br />
                                </div>
                            </div>
                            <!--Monthly Selection-->
                            <div id="Monthly" class="tabcontent">
                                <script>
                                    function DayWiseRadioCheck() {

                                        document.getElementById("MonthWiseSelection-daytype").disabled = "true";
                                        document.getElementById("MonthWiseSelection-day").disabled = "true";
                                        document.getElementById("MonthWiseSelection-Month").disabled = "true";

                                        document.getElementById("DayWiseSelection-Days").disabled = ! "true";
                                        document.getElementById("DayWiseSelection-Month").disabled = ! "true";
                                    }
                                    function MonthWiseRadioCheck() {
                                        document.getElementById("DayWiseSelection-Days").disabled = "true";
                                        document.getElementById("DayWiseSelection-Month").disabled = "true";
                                        document.getElementById("MonthWiseSelection-daytype").disabled = ! "true";
                                        document.getElementById("MonthWiseSelection-day").disabled = ! "true";
                                        document.getElementById("MonthWiseSelection-Month").disabled = ! "true";
                                    }
                                </script>
                                <input id="DayWise" type="radio" name="MonthlySelectionType" onclick="javascript:DayWiseRadioCheck()" value="1" checked="checked"/> Day
                                <input class="GeneralNumberInput" id="DayWiseSelection-Days" type="number" value="30" min="1" max="31" /> of every
                                <input class="GeneralNumberInput" id="DayWiseSelection-Month" type="number" value="1" min="1" /> Month.
                                <br />
                                <br />
                                <input id="MonthWiseSelection" type="radio" name="MonthlySelectionType" onclick="javascript:MonthWiseRadioCheck()" value="2" />
                                <select id="MonthWiseSelection-daytype" disabled>
                                    <option>First</option>
                                    <option>Second</option>
                                    <option>Third</option>
                                    <option>Fourth</option>
                                    <option>Last</option>
                                </select>
                                <select id="MonthWiseSelection-day" disabled>
                                    <option>Day</option>
                                    <option>WeekDay</option>
                                    <option>Weekend</option>
                                    <option>Sunday</option>
                                    <option>Monday</option>
                                    <option>Tuesday</option>
                                    <option>Wednesday</option>
                                    <option>Thursday</option>
                                    <option>Friday</option>
                                    <option>Saturday</option>
                                </select>
                                of every
                                <input class="GeneralNumberInput" id="MonthWiseSelection-Month" type="number" value="1" min="1" disabled/> Month.


                            </div>
                            <!--Custom Selection-->
                            <div id="Custom" class="tabcontent">

                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="6">
                            <input style="float:right;width:140px;" id="Fetch" type="button" value="Check Availability" class="MainButton" onclick="checkAvailability()" />
                        </td>
                    </tr>
                </table>
            </div>
            <!--Right division for Messages-->
            <div style="float:right;" class="innerDivisionright">
                <div id="messages" style="display:none">

                </div>
                <div id="unAvailableRoomsDiv" style="display:none">
                    <h3>Before proceed, please select different slots for below dates.</h3>
                    <table style="width:98%">
                        <tr id="CalendarTableForNotMatched">
                            <td>
                                <div class="ex1">
                                    <table class="RoomsNotAvailable" id="CalForNotMatched"></table>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        <div id="availableRooms" style="display:none">
            <div class="innerDivisionLower">
                <table style="width:98%">
                    <tr id="CalendarTable">
                        <td>
                            <div class="ex1">
                                <table class="Rooms" id="Cal"></table>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style="align-items:flex-end">
                            <input style="float:left;" id="Cancel" type="button" value="Cancel" class="MainButton" name="Command" onclick="CancelFetchAppointment()" />
                            <input style="float:right;" id="Submit" type="button" value="Submit" class="MainButton" name="Command" onclick="bookAppointment()" />
                        </td>
                    </tr>

                </table>
            </div>
        </div>
    </div>

}
<!--Duration Picker-->
<script>
    window.onload = function () {
        document.getElementById("defaultOpen").click();
    };

    //document.getElementById("StartTime").onchange();
</script>
